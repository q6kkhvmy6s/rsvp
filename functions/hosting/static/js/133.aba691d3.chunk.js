"use strict";(self.webpackChunkreservaciones_admin=self.webpackChunkreservaciones_admin||[]).push([[133],{3829:(e,s,t)=>{t.d(s,{GF:()=>n,Sk:()=>i,Yq:()=>a});const a=e=>{if(!e)return"";let s;return s=e&&"object"===typeof e&&"seconds"in e?new Date(1e3*e.seconds):new Date(e),isNaN(s.getTime())?"Invalid Date":s.toLocaleString("default",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})},i=e=>{const s=["linear-gradient(135deg, #f6d365 0%, #fda085 100%)","linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)","linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)","linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%)"];let t=0;for(let a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);return s[Math.abs(t)%s.length]},n=(e,s,t)=>{if(!e||0===e.length)return void alert("No reservations to export");const i=s.fields.map(e=>e.label);i.push("Promoter","Created At");const n=e.map(e=>{const i=s.fields.map(s=>{const t=e.formData[s.label]||"";return'"'.concat(String(t).replace(/"/g,'""'),'"')}),n=t[e.promoterId]||(e.promoterId?"Unknown":"Direct");i.push('"'.concat(n,'"'));const r=a(e.createdAt);return i.push('"'.concat(r,'"')),i.join(",")}),r=[i.join(","),...n].join("\n"),l=new Blob([r],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),o=URL.createObjectURL(l);c.setAttribute("href",o),c.setAttribute("download","".concat(s.title.replace(/[^a-z0-9]/gi,"_"),"_reservations_").concat((new Date).toISOString().split("T")[0],".csv")),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}},4133:(e,s,t)=>{t.r(s),t.d(s,{default:()=>y});var a=t(2555),i=t(5043),n=t(8163),r=t(6509),l=t(4063),c=t(4282),o=t(8258),d=t(8602),m=t(3519),h=t(6522),x=t(1072),u=t(7417),v=t(4196),j=t(196),p=t(6667),b=t(1614),f=t(5016),g=t(3829),A=t(579);const y=function(){const{id:e}=(0,n.g)(),s=(0,n.Zp)(),{userProfile:t}=(0,f.A)(),[y,N]=(0,i.useState)(null),[w,k]=(0,i.useState)([]),[C,S]=(0,i.useState)(!0),[I,R]=(0,i.useState)(null),[E,D]=(0,i.useState)({key:"createdAt",direction:"desc"}),[L,z]=(0,i.useState)({}),[F,P]=(0,i.useState)(""),[U,T]=(0,i.useState)(""),[_,G]=(0,i.useState)(""),B=window.location.origin,H="".concat(B,"/reservation/").concat(e)+("promoter"===(null===t||void 0===t?void 0:t.role)?"?ref=".concat(t.uid):""),M="".concat(B,"/join/").concat(e);(0,i.useEffect)(()=>{if(y){const e=y.fields.filter(e=>e.isInternal);1===e.length&&T(e[0].id)}},[y]),(0,i.useEffect)(()=>{if(U&&_){const s=new URLSearchParams;"promoter"===(null===t||void 0===t?void 0:t.role)&&s.append("ref",t.uid),s.append("field_id",U);const a=btoa(unescape(encodeURIComponent(_)));s.append("val",a),P("".concat(B,"/reservation/").concat(e,"?").concat(s.toString()))}else P("")},[e,B,t,U,_]),(0,i.useEffect)(()=>{(async()=>{try{S(!0);const s=(0,p.H9)(j.db,"events",e),t=await(0,p.x7)(s);if(t.exists()){const s=(0,a.A)({id:t.id},t.data());N(s);const i=(0,p.rJ)(j.db,"events",e,"reservations"),n=(0,p.P)(i,(0,p.My)("createdAt","desc")),r=(await(0,p.GG)(n)).docs.map(e=>(0,a.A)({id:e.id},e.data()));k(r);const l={},c=[...new Set(r.map(e=>e.promoterId).filter(Boolean))];for(const e of c){const s=await(0,p.x7)((0,p.H9)(j.db,"users",e));s.exists()&&(l[e]=s.data().username||s.data().email)}z(l)}else R("Event not found.")}catch(s){R("Failed to fetch data."),console.error(s)}finally{S(!1)}})()},[e]);const Y=(0,i.useMemo)(()=>{let e=[...w];return"promoter"===(null===t||void 0===t?void 0:t.role)&&(e=e.filter(e=>e.promoterId===t.uid)),E.key&&e.sort((e,s)=>{var t,a;let i=(null===(t=e.formData)||void 0===t?void 0:t[E.key])||e[E.key],n=(null===(a=s.formData)||void 0===a?void 0:a[E.key])||s[E.key];return"promoterId"===E.key&&(i=L[e.promoterId]||"",n=L[s.promoterId]||""),i<n?"asc"===E.direction?-1:1:i>n?"asc"===E.direction?1:-1:0}),e},[w,E,t,L]);return C?(0,A.jsx)(m.A,{className:"text-center my-5",children:(0,A.jsx)(u.A,{animation:"border"})}):I?(0,A.jsx)(m.A,{className:"my-5",children:(0,A.jsx)(r.A,{variant:"danger",children:I})}):(0,A.jsxs)(m.A,{className:"my-4",children:[(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2",children:[(0,A.jsxs)(c.A,{as:n.N_,to:"/",variant:"outline-secondary",children:[(0,A.jsx)("i",{className:"bi bi-arrow-left me-2"}),"Back to Dashboard"]}),"admin"===(null===t||void 0===t?void 0:t.role)&&(0,A.jsxs)("div",{className:"d-flex gap-2 flex-wrap",children:[(0,A.jsxs)(c.A,{variant:"outline-primary",onClick:()=>s("/edit/".concat(e)),children:[(0,A.jsx)("i",{className:"bi bi-pencil me-2"}),"Edit Event"]}),(0,A.jsxs)(c.A,{variant:!1!==y.acceptingReservations?"warning":"success",onClick:async()=>{if(!y)return;const s=!y.acceptingReservations;try{await(0,p.mZ)((0,p.H9)(j.db,"events",e),{acceptingReservations:s}),N(e=>(0,a.A)((0,a.A)({},e),{},{acceptingReservations:s}))}catch(t){console.error(t),alert("Failed to update reservation status")}},children:[(0,A.jsx)("i",{className:"bi ".concat(!1!==y.acceptingReservations?"bi-pause-circle":"bi-play-circle"," me-2")}),!1!==y.acceptingReservations?"Pause Reservations":"Resume Reservations"]}),(0,A.jsxs)(c.A,{variant:"outline-danger",onClick:async()=>{if(!y)return;const s="disabled"===y.status?"active":"disabled";try{await(0,p.mZ)((0,p.H9)(j.db,"events",e),{status:s}),N(e=>(0,a.A)((0,a.A)({},e),{},{status:s}))}catch(t){console.error(t),alert("Failed to update status")}},children:[(0,A.jsx)("i",{className:"bi bi-x-circle me-2"}),"disabled"===y.status?"Enable Event":"Disable Event"]}),(0,A.jsxs)(c.A,{variant:"success",onClick:()=>(0,g.GF)(w,y,L),children:[(0,A.jsx)("i",{className:"bi bi-download me-2"}),"Export CSV"]})]})]}),y&&(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(x.A,{className:"mb-4",children:[(0,A.jsxs)(d.A,{md:8,children:[(0,A.jsxs)("h1",{className:"display-6 fw-bold",children:[y.title,"disabled"===y.status&&(0,A.jsx)(l.A,{bg:"secondary",children:"Disabled"}),!1===y.acceptingReservations&&(0,A.jsx)(l.A,{bg:"warning",text:"dark",className:"ms-2",children:"Reservations Paused"})]}),(0,A.jsxs)("p",{className:"text-muted fs-5 mb-3",children:[(0,A.jsx)("i",{className:"bi bi-calendar-event me-2"}),(0,g.Yq)(y.time)]}),(0,A.jsx)("p",{className:"fs-6",children:y.description}),y.note&&(0,A.jsxs)(r.A,{variant:"info",className:"glass-card border-0",children:[(0,A.jsx)("strong",{children:"Note:"})," ",y.note]}),y.imageUrl&&"placeholder"!==y.imageUrl&&(0,A.jsx)(o.A,{className:"glass-card border-0 overflow-hidden mt-4",children:(0,A.jsx)(o.A.Img,{src:y.imageUrl,style:{width:"100%",height:"auto",maxHeight:"800px",objectFit:"contain",display:"block"}})})]}),(0,A.jsxs)(d.A,{md:4,children:[(0,A.jsx)(o.A,{className:"mb-3 glass-card border-0",children:(0,A.jsxs)(o.A.Body,{className:"text-center",children:[(0,A.jsx)("h5",{className:"fw-bold",children:"Reservation Link"}),(0,A.jsx)("div",{className:"my-3",children:(0,A.jsx)(b.h,{value:H,size:128})}),(0,A.jsx)("small",{className:"d-block text-break mb-2 text-muted",children:H}),(0,A.jsx)(c.A,{variant:"primary",size:"sm",className:"w-100",onClick:()=>navigator.clipboard.writeText(H),children:"Copy Link"})]})}),"admin"===(null===t||void 0===t?void 0:t.role)&&(0,A.jsx)(o.A,{className:"mb-3 glass-card border-0",children:(0,A.jsxs)(o.A.Body,{className:"text-center",children:[(0,A.jsx)("h5",{className:"fw-bold",children:"Invite Promoters"}),(0,A.jsx)("div",{className:"my-3",children:(0,A.jsx)(b.h,{value:M,size:128})}),(0,A.jsx)("small",{className:"d-block text-break mb-2 text-muted",children:M}),(0,A.jsx)(c.A,{variant:"outline-primary",size:"sm",className:"w-100",onClick:()=>navigator.clipboard.writeText(M),children:"Copy Invite Link"})]})}),(0,A.jsx)(o.A,{className:"glass-card border-0 mt-3",children:(0,A.jsxs)(o.A.Body,{children:[(0,A.jsx)("h5",{className:"fw-bold",children:"Create Link for Someone Else"}),(0,A.jsxs)(h.A.Group,{className:"mb-2",children:[(0,A.jsx)(h.A.Label,{className:"small",children:"Select Question to Answer"}),(0,A.jsxs)(h.A.Select,{size:"sm",value:U,onChange:e=>{T(e.target.value),G("")},children:[(0,A.jsx)("option",{value:"",children:"-- Select a Field --"}),y.fields.filter(e=>e.isInternal).map(e=>(0,A.jsx)("option",{value:e.id,children:e.label},e.id))]})]}),U&&(0,A.jsxs)(h.A.Group,{className:"mb-3",children:[(0,A.jsx)(h.A.Label,{className:"small",children:"Answer"}),(()=>{const e=y.fields.find(e=>e.id===Number(U)||e.id===U);return e?"select"===e.type?(0,A.jsxs)(h.A.Select,{size:"sm",value:_,onChange:e=>G(e.target.value),children:[(0,A.jsx)("option",{value:"",children:"Select option..."}),e.options.map((e,s)=>(0,A.jsx)("option",{value:e,children:e},s))]}):(0,A.jsx)(h.A.Control,{size:"sm",type:e.type,value:_,onChange:e=>G(e.target.value),placeholder:"Enter ".concat(e.label)}):null})()]}),F&&(0,A.jsxs)("div",{className:"mt-3",children:[(0,A.jsx)("small",{className:"d-block text-break mb-2 text-muted",children:F}),(0,A.jsx)(c.A,{variant:"outline-primary",size:"sm",className:"w-100",onClick:()=>navigator.clipboard.writeText(F),children:"Copy Link with Answer"})]})]})})]})]}),(0,A.jsx)("hr",{className:"my-4"}),(0,A.jsx)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:(0,A.jsxs)("div",{children:[(0,A.jsx)("h2",{className:"mb-1",children:"Reservations"}),"promoter"===(null===t||void 0===t?void 0:t.role)?(0,A.jsxs)("small",{className:"text-muted",children:["Total: ",(0,A.jsx)("strong",{children:w.length})," | Your Reservations: ",(0,A.jsx)("strong",{children:Y.length})]}):(0,A.jsxs)("small",{className:"text-muted",children:["Total: ",(0,A.jsx)("strong",{children:w.length})]})]})}),w.length>0?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,A.jsxs)(h.A.Group,{as:x.A,className:"align-items-center m-0",children:[(0,A.jsx)(h.A.Label,{column:!0,sm:"auto",children:"Sort by:"}),(0,A.jsx)(d.A,{sm:"auto",children:(0,A.jsxs)(h.A.Select,{onChange:e=>{const[s,t]=e.target.value.split("|");D({key:s,direction:t})},defaultValue:"".concat(E.key,"|").concat(E.direction),children:[(0,A.jsx)("option",{value:"createdAt|desc",children:"Most Recent"}),y.fields.map(e=>(0,A.jsx)("option",{value:"".concat(e.label,"|asc"),children:e.label},e.id)),(0,A.jsx)("option",{value:"promoterId|asc",children:"Promoter"})]})})]}),(0,A.jsx)(c.A,{variant:"primary",href:H,target:"_blank",children:"+ Create Reservation"})]}),(0,A.jsxs)(v.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[(0,A.jsx)("thead",{children:(0,A.jsxs)("tr",{children:[y.fields.map(e=>(0,A.jsxs)("th",{children:[e.label,e.isInternal&&(0,A.jsx)(l.A,{bg:"warning",text:"dark",className:"ms-1",children:"Internal"})]},e.id)),(0,A.jsx)("th",{children:"Promoter"}),(0,A.jsx)("th",{children:"Time"}),(0,A.jsx)("th",{children:"Actions"})]})}),(0,A.jsx)("tbody",{children:Y.map(s=>(0,A.jsxs)("tr",{children:[y.fields.map(e=>(0,A.jsx)("td",{children:s.formData[e.label]||"-"},e.id)),(0,A.jsx)("td",{children:L[s.promoterId]||(s.promoterId?"Unknown":"-")}),(0,A.jsx)("td",{children:(0,g.Yq)(s.createdAt)}),(0,A.jsx)("td",{children:("admin"===(null===t||void 0===t?void 0:t.role)||"promoter"===(null===t||void 0===t?void 0:t.role)&&s.promoterId===t.uid)&&(0,A.jsxs)(c.A,{variant:"outline-danger",size:"sm",onClick:()=>(async s=>{if(window.confirm("Are you sure you want to delete this reservation?"))try{await(0,p.kd)((0,p.H9)(j.db,"events",e,"reservations",s)),k(e=>e.filter(e=>e.id!==s))}catch(t){console.error("Error deleting reservation:",t),alert("Failed to delete reservation.")}})(s.id),children:[(0,A.jsx)("i",{className:"bi bi-trash"})," Delete"]})})]},s.id))})]})]}):(0,A.jsx)(r.A,{variant:"info",children:"No reservations found."})]})]})}}}]);
//# sourceMappingURL=133.aba691d3.chunk.js.map